1ï¸âƒ£ Open MySQL Port on MASTER

On 114.130.69.249

ufw allow 3306

ğŸŸ¢ STEP 1: Configure MySQL MASTER (114.130.69.249)

ğŸ“ WHERE to Create the MySQL Master Config

You should create it in the same directory where your docker-compose.yml lives on the MASTER server:

ğŸ“Œ Server: 114.130.69.249
ğŸ“Œ User: root

âœ… Correct Directory Structure (MASTER)

Assuming your project is here:

/var/www/saas-crm-ihelp/


Your structure should look like this:

/var/www/saas-crm-ihelp/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ .env
â”œâ”€â”€ mysql-master/
â”‚   â””â”€â”€ conf/
â”‚       â””â”€â”€ my.cnf   ğŸ‘ˆ CREATE THIS FILE HERE
â”œâ”€â”€ nginx/
â”œâ”€â”€ app/
â””â”€â”€ ...


Then verify:

docker exec saas_crm_ihelp_db mysql -uroot -p -e "SHOW VARIABLES LIKE 'log_bin';"

You should see:

log_bin | ON

ğŸ“ Create MySQL Master Config
mkdir -p mysql-master/conf
nano mysql-master/conf/my.cnf

[mysqld]
server-id=1
log-bin=mysql-bin
binlog_format=ROW
binlog_do_db=your_database_name
bind-address=0.0.0.0


***Because you have multiple databases, update your MASTER config.

ğŸ”§ MASTER my.cnf
[mysqld]
server-id=1
log-bin=mysql-bin
binlog_format=ROW
bind-address=0.0.0.0


âŒ REMOVE THIS LINE if present:

binlog_do_db=your_database_name


ğŸ‘‰ Otherwise only one database will replicate.


ğŸ³ Your MASTER docker-compose.yml (DB Part)
Ensure this volume exists:

db:
  image: mysql:8.0-oraclelinux8
  container_name: saas_crm_ihelp_db
  restart: unless-stopped
  env_file:
    - .env
  environment:
    MYSQL_ROOT_PASSWORD: ${DB_PASSWORD}
    MYSQL_DATABASE: ${DB_DATABASE}
  volumes:
    - saas_crm_ihelp_db_data:/var/lib/mysql
    - ./mysql-master/conf/my.cnf:/etc/mysql/conf.d/my.cnf
  ports:
    - "3306:3306"

ğŸ”„ Restart MySQL
docker compose down
docker compose up -d

ğŸŸ¢ STEP 2: Create Replication User (MASTER)
docker exec -it saas_crm_ihelp_db mysql -uroot -p

CREATE USER 'repl'@'%' IDENTIFIED BY 'repl_password';
GRANT REPLICATION SLAVE ON *.* TO 'repl'@'%';
FLUSH PRIVILEGES;

ğŸ“Œ Get MASTER Status (CRITICAL)
SHOW MASTER STATUS;


Example output:

File: mysql-bin.000003
Position: 157


ğŸ‘‰ Save these values (youâ€™ll need them)

ğŸŸ¢ STEP 3: Take Consistent Backup from MASTER
docker exec saas_crm_ihelp_db \
mysqldump -uroot -p \
--single-transaction \
--routines \
--triggers \
--databases your_database_name > backup.sql


alternative copy databases====================1.0 
Backup EVERYTHING (ALL DATABASES)

If you want everything including system DBs:

docker exec saas_crm_ihelp_db \
mysqldump -uroot -p \
--single-transaction \
--all-databases \
--routines \
--triggers \
--events \
> full_backup.sql


âš ï¸ Use this only if SLAVE is clean (empty MySQL).

alternative copy databases====================2.0 

Take Backup on MASTER (114.130.69.249)

Run this on the MASTER server:

docker exec saas_crm_ihelp_db \
mysqldump \
--socket=/var/run/mysqld/mysqld.sock \
-uroot \
--single-transaction \
--routines \
--triggers \
--events \
--databases \
sass_crm_db_ihelp_2025 \
sass_crm_db_ihelp_2025_gates-and-watkins-traders \
sass_crm_db_ihelp_2025_ihelpbd-2026 \
sass_crm_db_ihelp_2025_ihelpkl \
sass_crm_db_ihelp_2025_sakil-com \
> all_crm_databases.sql




ğŸ“¤ Copy Backup to SLAVE Server

From your local machine or MASTER:

scp backup.sql root@114.130.69.223:/root/

ğŸŸ¡ STEP 4: Setup MySQL SLAVE (114.130.69.223)
ğŸ“ Create Slave Config

ğŸŸ¡ SLAVE Server Location (For Comparison)

On 114.130.69.223, same idea:

/var/www/mysql-slave/
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ mysql-slave/
    â””â”€â”€ conf/
        â””â”€â”€ my.cnf


mkdir -p mysql-slave/conf
nano mysql-slave/conf/my.cnf

[mysqld]
server-id=2
relay-log=relay-log
read_only=ON
bind-address=0.0.0.0

ğŸ³ Slave docker-compose.yml

Minimal version:

version: "3.9"

services:
  db:
    image: mysql:8.0-oraclelinux8
    container_name: mysql_slave
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: your_root_password
    volumes:
      - mysql_slave_data:/var/lib/mysql
      - ./mysql-slave/conf/my.cnf:/etc/mysql/conf.d/my.cnf
    ports:
      - "3306:3306"

volumes:
  mysql_slave_data:

â–¶ Start Slave
docker compose up -d


ğŸ” Final Safety Check (Recommended)

On SLAVE:

SHOW VARIABLES LIKE 'read_only';


Must be:

read_only | ON

ğŸŸ¡ STEP 5: Restore Backup on SLAVE
docker exec -i mysql_slave mysql -uroot -p < backup.sql

ğŸ”´ STEP 6: Configure Replication on SLAVE
docker exec -it mysql_slave mysql -uroot -p

CHANGE MASTER TO
MASTER_HOST='114.130.69.249',
MASTER_USER='repl',
MASTER_PASSWORD='repl_password',
MASTER_LOG_FILE='mysql-bin.000003',
MASTER_LOG_POS=157;

START SLAVE;

âœ… Verify Replication
SHOW SLAVE STATUS\G


You MUST see:

Slave_IO_Running: Yes
Slave_SQL_Running: Yes


ğŸ‰ Replication is LIVE

ğŸŸ£ STEP 7: Real-Time Backup Strategy (Slave)
ğŸ“¦ Daily Backup from SLAVE (Recommended)

Create cron job on 114.130.69.223:

crontab -e

0 2 * * * docker exec mysql_slave \
mysqldump -uroot -pPASSWORD your_database_name \
> /backup/db_$(date +\%F).sql


âœ” No load on MASTER
âœ” Safe rollback point

ğŸ§  Best Practices (Strongly Recommended)

âœ… Never write to SLAVE
âœ… Monitor replication lag

Seconds_Behind_Master


âœ… Use SLAVE for:

Reporting

Analytics

Full backups



ğŸŸ¢ Solution: Use a DEDICATED DUMP USER (Recommended for Production)

This avoids all root auth weirdness and is how MySQL is meant to be used.

ğŸ”¹ STEP 1: Create a Backup User (ONE TIME)

Run this inside the container (this login will work):

docker exec -it saas_crm_ihelp_db mysql -uroot -p


Enter your root password, then run:

CREATE USER 'backup'@'%' IDENTIFIED BY 'Backup@123';
GRANT SELECT, SHOW VIEW, TRIGGER, EVENT, LOCK TABLES ON *.* TO 'backup'@'%';
FLUSH PRIVILEGES;
EXIT;

(BEST & SIMPLE): Disable Tablespace Dump

Just add one flag.

âœ” RECOMMENDED COMMAND (SAFE)
docker exec saas_crm_ihelp_db \
mysqldump \
-h127.0.0.1 \
--protocol=tcp \
-ubackup \
-pBackup@123 \
--single-transaction \
--routines \
--triggers \
--events \
--no-tablespaces \
--databases \
sass_crm_db_ihelp_2025 \
sass_crm_db_ihelp_2025_gates-and-watkins-traders \
sass_crm_db_ihelp_2025_ihelpbd-2026 \
sass_crm_db_ihelp_2025_ihelpkl \
sass_crm_db_ihelp_2025_sakil-com \
> all_crm_databases.sql


ğŸ‘‰ This is industry best practice
ğŸ‘‰ No need for PROCESS privilege
ğŸ‘‰ 100% safe for restores

ğŸ” FIX OPTION 2 (NOT RECOMMENDED): Grant PROCESS Privilege

Only do this if you insist.

GRANT PROCESS ON *.* TO 'backup'@'%';
FLUSH PRIVILEGES;


âš ï¸ Gives wider visibility â€” not ideal for backups.

âœ… Verify Success
ls -lh all_crm_databases.sql


Expected:

File size increasing

No errors

Optional:

grep "CREATE DATABASE" all_crm_databases.sql


You should see all 5 databases.

